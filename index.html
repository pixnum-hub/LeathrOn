<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LeatherOn â€“ International Costing Calculator</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#e6e6e6">

<style>
:root{
  --bg:#e6e6e6;
  --card:#f0f0f0;
  --text:#111;
  --shadow1:#ffffff;
  --shadow2:#bebebe;
}
body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#f5f5f5;
  --shadow1:#2a2a2a;
  --shadow2:#000;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
}

.app{
  width:100%;
  max-width:420px;
  padding:16px;
  box-sizing:border-box;
}

.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  box-shadow:8px 8px 16px var(--shadow2),
             -8px -8px 16px var(--shadow1);
  position:relative;
}

h2{margin-top:0;text-align:center}

/* Dark toggle */
#darkToggle{
  position:absolute;
  top:12px;
  right:12px;
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:var(--card);
  box-shadow: inset 4px 4px 8px var(--shadow2),
              inset -4px -4px 8px var(--shadow1);
  font-size:18px;
  cursor:pointer;
}

/* Inputs */
input,select,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:12px;
  border:none;
  font-size:14px;
  background:var(--bg);
  color:var(--text);
  box-shadow: inset 4px 4px 8px var(--shadow2),
              inset -4px -4px 8px var(--shadow1);
}

.row{
  display:flex;
  gap:8px;
}
.row > *{flex:1}

/* Buttons */
button.primary{
  background:#4caf50;
  color:#fff;
  box-shadow:none;
}
button.warn{
  background:#f44336;
  color:#fff;
  box-shadow:none;
}

/* Product list */
.product{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  padding:6px 0;
  border-bottom:1px dashed #aaa;
}

/* Popup */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.popup .card{
  max-height:90vh;
  overflow:auto;
}

/* Lock screen */
.lock{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
.lock .card{max-width:340px}
</style>
</head>

<body>
<div class="app">

  <!-- LOCK -->
  <div class="lock" id="lock">
    <div class="card">
      <h2>App Locked</h2>
      <p id="lockMsg"></p>
      <input id="adminCode" placeholder="Admin Code">
      <button class="primary" onclick="unlockAdmin()">Unlock</button>
      <button onclick="simulatePay()">Subscribe $10/month</button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="card">
    <button id="darkToggle">ðŸŒ™</button>
    <h2>LeatherOn Calculator</h2>

    <div class="row">
      <select id="currency">
        <option value="$">$ USD</option>
        <option value="â‚¬">â‚¬ EUR</option>
        <option value="â‚¹">â‚¹ INR</option>
      </select>
      <input id="gst" type="number" placeholder="GST %">
    </div>

    <input id="profit" type="number" placeholder="Profit %">

    <button onclick="openPopup()">âž• Add Product</button>

    <div id="products"></div>

    <h3>Grand Total: <span id="total">$0.00</span></h3>

    <button class="primary" onclick="calcTotal()">Calculate Grand Total</button>
    <button class="warn" onclick="resetAll()">Reset</button>
  </div>
</div>

<!-- ADD PRODUCT -->
<div class="popup" id="popup">
  <div class="card">
    <h3>Add Product</h3>
    <input id="pname" placeholder="Product name">
    <div class="row">
      <input id="pqty" type="number" placeholder="Qty">
      <input id="pcost" type="number" placeholder="Unit cost">
    </div>
    <button class="primary" onclick="addProduct()">Add</button>
    <button onclick="closePopup()">Cancel</button>
  </div>
</div>

<script>
/* ---------- DEVICE LOCK ---------- */
const deviceKey="leatheron-device";
const trialKey="leatheron-trial";
const subKey="leatheron-sub";

function initLock(){
  let d=localStorage.getItem(deviceKey);
  if(!d){
    localStorage.setItem(deviceKey, navigator.userAgent);
    localStorage.setItem(trialKey, Date.now());
  }else if(d!==navigator.userAgent){
    showLock("Device changed. Locked.");
  }
  checkTrial();
}

function checkTrial(){
  const start=+localStorage.getItem(trialKey);
  const days=Math.floor((Date.now()-start)/86400000);
  if(days>30 && !localStorage.getItem(subKey)){
    showLock("Trial expired. Subscribe to continue.");
  }
}

function showLock(msg){
  document.getElementById("lockMsg").innerText=msg;
  document.getElementById("lock").style.display="flex";
}

function unlockAdmin(){
  if(document.getElementById("adminCode").value==="MR-ADMIN-2026"){
    localStorage.setItem(subKey,"admin");
    document.getElementById("lock").style.display="none";
  }
}
function simulatePay(){
  alert("Payment simulated. Subscription activated.");
  localStorage.setItem(subKey,"paid");
  document.getElementById("lock").style.display="none";
}

/* ---------- DARK MODE ---------- */
const toggle=document.getElementById("darkToggle");
toggle.onclick=()=>{
  document.body.classList.toggle("dark");
  toggle.textContent=document.body.classList.contains("dark")?"â˜€ï¸":"ðŸŒ™";
};
if(localStorage.theme==="dark"){
  document.body.classList.add("dark");
  toggle.textContent="â˜€ï¸";
}

/* ---------- PRODUCTS ---------- */
let products=[];
function openPopup(){document.getElementById("popup").style.display="flex";}
function closePopup(){document.getElementById("popup").style.display="none";}

function addProduct(){
  products.push({
    name:pname.value,
    qty:+pqty.value,
    cost:+pcost.value
  });
  pname.value=pqty.value=pcost.value="";
  render();
  closePopup();
}

function render(){
  const list=document.getElementById("products");
  list.innerHTML="";
  products.forEach(p=>{
    const d=document.createElement("div");
    d.className="product";
    d.innerHTML=`${p.name} Ã— ${p.qty}<span>${p.qty*p.cost}</span>`;
    list.appendChild(d);
  });
}

function calcTotal(){
  let sum=products.reduce((a,p)=>a+p.qty*p.cost,0);
  const gst=+gstInput.value||0;
  const profit=+profitInput.value||0;
  sum+=sum*(gst/100);
  sum+=sum*(profit/100);
  total.innerText=currency.value+sum.toFixed(2);
}

function resetAll(){
  products=[];
  render();
  gst.value=profit.value="";
  total.innerText=currency.value+"0.00";
}

/* ---------- PWA ---------- */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}

const gstInput=document.getElementById("gst");
const profitInput=document.getElementById("profit");

initLock();
</script>
</body>
</html>
