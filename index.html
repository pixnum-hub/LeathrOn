<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LeathrOn - Leather Costing Calculator</title>
<style>
/* ===== GLOBAL ===== */
* { box-sizing: border-box; }
html, body { margin:0; padding:0; font-family: Arial, sans-serif; font-size: 17px; background:#e0e0e0; transition:0.3s; }
.dark { background:#1c1c1c; color:#fff; }

/* ===== APP CONTAINER ===== */
.app {
  position: relative; width: 90%; max-width: 720px; margin: 0 auto; padding: 15px; border-radius: 25px;
  background:#e6e6e6; box-shadow:8px 8px 16px #b8b8b8, -8px -8px 16px #ffffff;
}
.dark .app { background:#2a2a2a; box-shadow:8px 8px 16px #161616, -8px -8px 16px #3a3a3a; }

/* ===== INPUT GROUPS ===== */
.inputGroup { display:flex; flex-direction: column; margin:8px 0; }
.inputGroup label { font-weight: bold; margin-bottom: 5px; }
input, select, textarea { width:100%; max-width:100%; padding:12px; font-size:16px; border:none; border-radius:12px;
  background:#f2f2f2; box-shadow: inset 4px 4px 8px #bcbcbc, inset -4px -4px 8px #ffffff; outline:none; }
.dark input, .dark select, .dark textarea { background:#333; color:#fff; box-shadow: inset 4px 4px 8px #141414, inset -4px -4px 8px #474747; }

/* ===== BUTTONS ===== */
button { padding:14px; border:none; border-radius:18px; margin:8px 0; width:100%; font-size:16px; cursor:pointer;
  background:#e6e6e6; box-shadow:6px 6px 12px #b8b8b8, -6px -6px 12px #ffffff; }
.dark button { background:#333; color:#fff; box-shadow:6px 6px 12px #141414, -6px -6px 12px #474747; }

/* ===== PRODUCT CARD ===== */
.prodCard { padding:12px; border-radius:15px; background:#f3f3f3; margin:10px 0; font-size:16px; 
  box-shadow: inset 3px 3px 7px #bcbcbc, inset -3px -3px 7px #ffffff; }
.dark .prodCard { background:#333; box-shadow: inset 3px 3px 7px #141414, inset -3px -3px 7px #474747; }
.prodTitle { font-size:18px; font-weight:bold; margin-bottom:6px; }

/* ===== FOOTER ===== */
footer { position:fixed; bottom:0; left:0; width:100%; padding:12px 0; text-align:center; font-size:15px;
  background: rgba(224,224,224,0.7); backdrop-filter:blur(10px); box-shadow:0 -3px 12px rgba(0,0,0,0.2); }
.dark footer { background: rgba(30,30,30,0.65); color:#fff; }

/* ===== DARK MODE TOGGLE ===== */
.toggleDark { position: fixed; top:10px; right:10px; width:60px; height:60px; border-radius:50%;
  background:#e6e6e6; display:flex; align-items:center; justify-content:center; font-size:26px; cursor:grab;
  box-shadow:6px 6px 12px #b8b8b8, -6px -6px 12px #ffffff; z-index:9999; transition:0.2s; }
.dark .toggleDark { background:#333; box-shadow:6px 6px 12px #141414, -6px -6px 12px #474747; }
.toggleDark:active { transform:scale(1.1); cursor:grabbing; }

/* ===== ADD PRODUCT POPUP ===== */
.popup-overlay {
  position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6);
  display: none; justify-content: center; align-items: flex-start; padding:5px; z-index: 9999;
}
.popup-container {
  width:100%; max-width: 95%; background:#e0e0e0; border-radius:20px; padding:10px;
  max-height: 95vh; overflow-y:auto; box-shadow: 8px 8px 20px #b8b8b8, -8px -8px 20px #ffffff;
  position: relative; top: 10px;
}
.dark .popup-container { background:#2a2a2a; box-shadow:8px 8px 20px #161616, -8px -8px 20px #3a3a3a; }
.popup-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; cursor: grab; }
.close-btn { font-size:28px; background:none; border:none; cursor:pointer; }
#imgPrevContainer img { width:100%; border-radius:12px; margin-top:8px; }
.popup-footer { display:flex; justify-content:space-between; margin-top:12px; }
.btn-cancel, .btn-save { padding:12px 20px; border-radius:14px; font-size:15px; width:48%; border:none; cursor:pointer; }
.btn-cancel { background:#ffdddd; } .btn-save { background:#c8ffc8; }

/* ===== POPUP BODY TWO-COLUMN RESPONSIVE ===== */
.popup-body {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
@media (min-width: 600px) {
  .popup-body {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
  }
  .popup-body .inputGroup { width:48%; }
}
</style>
</head>

<body>
<div class="app" id="mainContainer">

  <!-- DARK MODE TOGGLE -->
  <div class="toggleDark" id="darkToggle"><span id="darkIcon">üåô</span></div>

  <h2 style="text-align:center;">LeathrOn</h2>

  <!-- SUBSCRIPTION -->
  <div id="subscriptionUI"></div>

  <!-- MAIN APP -->
  <div id="mainApp">
    <button onclick="openAddProduct()">‚ûï Add Product</button>
    <button onclick="resetAll()">üóë Reset All</button>

    <div class="inputGroup"><label>Search Products</label><input id="searchProd" placeholder="Search Products" oninput="filterProducts()"></div>

    <div id="productList"></div>

    <div class="inputGroup"><label>GST %</label><input id="gst" type="number" value="18"></div>
    <div class="inputGroup"><label>Profit %</label><input id="profit" type="number" value="20"></div>

    <div class="inputGroup"><label>Currency</label><select id="currency"><option value="INR">INR ‚Çπ</option><option value="USD">USD $</option></select></div>

    <button onclick="calculateFinal()">Calculate Grand Total</button>
    <h2 id="grandTotal"></h2>

    <button onclick="exportTXT()">Export TXT</button>
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="generatePDFMenu()">Export PDF</button>
    <button onclick="showInvoiceHistory()">Invoice History</button>
  </div>
</div>

<!-- ADD PRODUCT POPUP -->
<div id="addProductPopup" class="popup-overlay">
  <div class="popup-container">
    <div class="popup-header">
      <h2>Add New Product</h2>
      <button class="close-btn" onclick="closeAddProduct()">√ó</button>
    </div>
    <div class="popup-body">
      <div class="inputGroup"><label>Product Type</label><select id="p_type"><option>Bag</option><option>Wallet</option><option>Belt</option><option>Shoe</option><option>Other</option></select></div>
      <div class="inputGroup"><label>Material</label><select id="p_material"><option>Full-Grain</option><option>Top-Grain</option><option>Bonded</option></select></div>
      <div class="inputGroup"><label>Grade</label><input id="p_grade"></div>
      <div class="inputGroup"><label>Thickness (mm)</label><input id="p_thick" type="number"></div>
      <div class="inputGroup"><label>Leather Area (sq.ft)</label><input id="p_area" type="number"></div>
      <div class="inputGroup"><label>Leather Rate</label><input id="p_rate" type="number"></div>
      <div class="inputGroup"><label>Quantity</label><input id="p_qty" type="number" value="1"></div>
      <div class="inputGroup"><label>Extra Expenses</label><input id="p_extra" type="number"></div>
      <div class="inputGroup"><label>Notes</label><textarea id="p_note"></textarea></div>
      <div class="inputGroup"><label>Product Image</label><input id="p_img" type="file" accept="image/*"><div id="imgPrevContainer"></div></div>
    </div>
    <div class="popup-footer">
      <button class="btn-cancel" onclick="closeAddProduct()">Cancel</button>
      <button class="btn-save" id="saveProdBtn">Save Product</button>
    </div>
  </div>
</div>

<footer>¬© <span id="year"></span> Manik Roy. All Right Reserved.</footer>

<script>
/* ===== GENERAL ===== */
document.getElementById("year").textContent = new Date().getFullYear();
let products=[];

/* ===== ADD PRODUCT POPUP ===== */
function openAddProduct(){ 
  const popup=document.getElementById("addProductPopup");
  const container=popup.querySelector(".popup-container");
  container.style.top="10px"; // reset top
  popup.style.display="flex"; 
}
function closeAddProduct(){ document.getElementById("addProductPopup").style.display="none"; }

document.getElementById("p_img").addEventListener("change", e=>{
  const f=e.target.files[0]; const container=document.getElementById("imgPrevContainer");
  if(f){ const r=new FileReader(); r.onload=()=>{ container.innerHTML=`<img src='${r.result}'>`; }; r.readAsDataURL(f); }
});

document.getElementById("saveProdBtn").addEventListener("click",()=>{
  const p={
    type:document.getElementById("p_type").value,
    material:document.getElementById("p_material").value,
    grade:document.getElementById("p_grade").value,
    thick:Number(document.getElementById("p_thick").value),
    area:Number(document.getElementById("p_area").value),
    rate:Number(document.getElementById("p_rate").value),
    qty:Number(document.getElementById("p_qty").value),
    extra:Number(document.getElementById("p_extra").value),
    note:document.getElementById("p_note").value,
    img:document.getElementById("imgPrevContainer").querySelector("img")?.src||""
  };
  p.total=(p.area*p.rate+p.extra)*p.qty;
  products.push(p); closeAddProduct(); renderProducts();
});

function renderProducts(){ 
  const box=document.getElementById("productList"); 
  box.innerHTML=""; 
  products.forEach((p,i)=>{
    box.innerHTML+=`<div class='prodCard'><div class='prodTitle'>${p.type} (${p.material}) x${p.qty}</div>
      Area: ${p.area} | Rate: ${p.rate}<br>Total: ‚Çπ${p.total.toFixed(2)}<br>
      <button onclick='delProd(${i})'>Delete</button><button onclick='cloneProd(${i})'>Duplicate</button></div>`;
  }); 
}
function delProd(i){ products.splice(i,1); renderProducts(); }
function cloneProd(i){ products.push(JSON.parse(JSON.stringify(products[i]))); renderProducts(); }
function filterProducts(){ 
  const q=document.getElementById("searchProd").value.toLowerCase(); 
  const filtered=products.filter(p=>p.type.toLowerCase().includes(q)||p.material.toLowerCase().includes(q));
  products=filtered; renderProducts();
}
function resetAll(){ 
  if(confirm("Clear all products and inputs?")){ 
    products=[]; renderProducts(); 
    document.getElementById("grandTotal").innerHTML=""; 
    document.getElementById("gst").value=18; 
    document.getElementById("profit").value=20; 
    document.getElementById("currency").value="INR"; 
    document.getElementById("searchProd").value=""; 
  } 
}

/* ===== DARK MODE TOGGLE ===== */
const darkIcon=document.getElementById("darkIcon");
const toggle=document.getElementById("darkToggle");
let dragging=false,startX=0,startY=0;

function toggleDarkMode(){
    document.body.classList.toggle("dark");
    const isDark=document.body.classList.contains("dark");
    darkIcon.textContent=isDark?"‚òÄÔ∏è":"üåô";
    localStorage.lc_dark=isDark?"yes":"no";
}

if(localStorage.lc_dark==="yes"){ document.body.classList.add("dark"); darkIcon.textContent="‚òÄÔ∏è"; }

toggle.addEventListener("mousedown", startDrag);
toggle.addEventListener("touchstart", startDrag,{passive:false});

function startDrag(e){
    e.preventDefault();
    dragging=false;
    const clientX=e.touches?e.touches[0].clientX:e.clientX;
    const clientY=e.touches?e.touches[0].clientY:e.clientY;
    startX=clientX; startY=clientY;
    document.addEventListener(e.type.includes("touch")?"touchmove":"mousemove", dragMove,{passive:false});
    document.addEventListener(e.type.includes("touch")?"touchend":"mouseup", endDrag);
}

function dragMove(e){
    e.preventDefault();
    dragging=true;
    const clientX=e.touches?e.touches[0].clientX:e.clientX;
    const clientY=e.touches?e.touches[0].clientY:e.clientY;
    let x=clientX-30; let y=clientY-30;
    x=Math.max(0,Math.min(window.innerWidth-60,x));
    y=Math.max(0,Math.min(window.innerHeight-60,y));
    toggle.style.left=x+"px"; toggle.style.top=y+"px";
}

function endDrag(e){
    document.removeEventListener("mousemove", dragMove);
    document.removeEventListener("mouseup", endDrag);
    document.removeEventListener("touchmove", dragMove);
    document.removeEventListener("touchend", endDrag);
    if(!dragging) toggleDarkMode();
}

/* ===== VERTICALLY DRAGGABLE POPUP ===== */
const popup = document.getElementById("addProductPopup");
const popupContainer = popup.querySelector(".popup-container");
const popupHeader = popup.querySelector(".popup-header");
let popupDragging = false, popupStartY = 0;

popupHeader.addEventListener("mousedown", startPopupDrag);
popupHeader.addEventListener("touchstart", startPopupDrag, {passive:false});

function startPopupDrag(e){
    e.preventDefault();
    popupDragging = false;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    popupStartY = clientY - popupContainer.getBoundingClientRect().top;
    document.addEventListener(e.type.includes("touch")?"touchmove":"mousemove", dragPopup,{passive:false});
    document.addEventListener(e.type.includes("touch")?"touchend":"mouseup", endPopupDrag);
}

function dragPopup(e){
    e.preventDefault();
    popupDragging = true;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    let y = clientY - popupStartY;
    y = Math.max(10, Math.min(window.innerHeight - popupContainer.offsetHeight - 10, y));
    popupContainer.style.position = "absolute";
    popupContainer.style.top = y + "px";
}

function endPopupDrag(e){
    document.removeEventListener("mousemove", dragPopup);
    document.removeEventListener("mouseup", endPopupDrag);
    document.removeEventListener("touchmove", dragPopup);
    document.removeEventListener("touchend", endPopupDrag);
}
</script>
</body>
</html>
