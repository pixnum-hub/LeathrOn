<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LeathrOn - Leather Costing Calculator</title>
<style>
:root {
    --bg: #e0e0e0;
    --card: #e6e6e6;
    --text: #000;
    --shadow-light: #ffffff;
    --shadow-dark: #b8b8b8;
    --input-bg: #f2f2f2;
}
body.dark {
    --bg: #1c1c1c;
    --card: #2a2a2a;
    --text: #fff;
    --shadow-light: #3a3a3a;
    --shadow-dark: #141414;
    --input-bg: #333;
}
body {
    margin:0;
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    transition:0.3s;
}
.app-container {
    width: 95%;
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
    background: var(--card);
    border-radius: 25px;
    box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
    box-sizing: border-box;
}
label { display:block; margin-top:10px; font-weight:bold; }
input, select, textarea {
    width:100%;
    padding:12px;
    margin-top:5px;
    border-radius:15px;
    border:none;
    background: var(--input-bg);
    color: var(--text);
    box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
    box-sizing:border-box;
    font-size:16px;
}
button {
    padding:14px;
    border:none;
    border-radius:18px;
    margin-top:10px;
    width:100%;
    font-size:16px;
    cursor:pointer;
    background: var(--card);
    color: var(--text);
    box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    transition:0.2s;
}
button:hover { transform: scale(1.02); }
.product-box {
    background: var(--card);
    padding: 15px;
    border-radius: 18px;
    margin-top: 12px;
    font-size: 14px;
    box-shadow: inset 3px 3px 7px var(--shadow-dark), inset -3px -3px 7px var(--shadow-light);
}
.product-box b { font-size: 16px; }
.product-box .prod-btn { margin-top:6px; padding:8px; font-size:14px; }
#popup {
    position: fixed;
    top:50%;
    left:50%;
    transform: translate(-50%,-50%);
    width: 92%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    background: var(--card);
    color: var(--text);
    border-radius: 20px;
    padding: 20px;
    z-index: 3000;
    display: none;
    box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
}
#darkToggle {
    width: 60px;
    height: 60px;
    background: var(--card);
    border-radius: 50%;
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 5000;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: grab;
    font-size: 24px;
    box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    transition:0.2s;
}
#darkToggle:active { transform: scale(1.1); cursor: grabbing; }
#subscriptionUI {
    margin: 10px 0;
    padding: 10px;
    text-align: center;
    font-weight:bold;
    border-radius:15px;
    box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
    background: var(--card);
}
footer {
    text-align:center;
    margin-top:20px;
}
</style>
</head>
<body>

<div id="darkToggle">üåô</div>

<div class="app-container">
<h2>LeathrOn</h2>

<div id="subscriptionUI"></div>

<div id="mainApp" style="display:none;">

<label>Search Products</label>
<input type="text" id="search" onkeyup="renderProducts()" placeholder="Search Products...">

<label>GST (%)</label>
<input type="number" id="gst" value="18">

<label>Profit (%)</label>
<input type="number" id="profit" value="20">

<label>Currency</label>
<select id="currency">
<option value="INR">INR ‚Çπ</option>
<option value="USD">USD $</option>
</select>

<button onclick="openPopup()">‚ûï Add Product</button>
<button onclick="resetAll()">üóë Reset All</button>

<h3>Products</h3>
<div id="productList"></div>

<button onclick="calculateFinal()">Calculate Grand Total</button>
<h2 id="grandTotal"></h2>

</div>
</div>

<!-- Add Product Popup -->
<div id="popup">
<h3>Add New Product</h3>
<label>Product Name</label><input type="text" id="pname">
<label>Product Category</label><select id="pcategory"><option>Bag</option><option>Wallet</option><option>Belt</option><option>Shoe</option><option>Other</option></select>
<label>Leather Type</label><select id="ptype"><option>Full-Grain</option><option>Top-Grain</option><option>Bonded</option></select>
<label>Leather Grade</label><select id="pgrade"><option>A</option><option>B</option><option>C</option><option>D</option></select>
<label>Leather Thickness (mm)</label><input type="number" id="pthickness">
<label>Color</label><input type="text" id="pcolor">
<label>Size (L√óW)</label><input type="text" id="psize">
<label>Leather Rate</label><input type="number" id="prate">
<label>Quantity</label><input type="number" id="pqty" value="1">
<label>Waste %</label><input type="number" id="pwaste" value="0">
<label>Labour Cost</label><input type="number" id="plabour" value="0">
<label>Chemical Cost</label><input type="number" id="pchemical" value="0">
<label>Machine Cost</label><input type="number" id="pmachine" value="0">
<label>Transport Cost</label><input type="number" id="ptransport" value="0">
<label>Markup %</label><input type="number" id="pmarkup" value="0">
<label>SKU / Product Code</label><input type="text" id="psku">
<label>Notes / Description</label><textarea id="pnote"></textarea>
<label>Supplier Name</label><input type="text" id="psupplier">
<label>Supplier Contact</label><input type="text" id="psuppliercontact">
<label>Batch Number</label><input type="text" id="pbatch">
<label>Manufacturing Date</label><input type="date" id="pmfg">
<label>Leather Origin (Country)</label><input type="text" id="porigin">
<label>Production Time (Hours)</label><input type="number" id="ptime">
<label>Storage Location</label><input type="text" id="plocation">
<label>Tax Type</label><select id="ptax"><option>GST</option><option>IGST</option><option>NO TAX</option></select>

<button onclick="saveProduct()">Save Product</button>
<button onclick="closePopup()" style="background:#444;">Cancel</button>
</div>

<footer>¬© <span id="year"></span> Manik Roy. All Right Reserved.</footer>

<script>
document.getElementById("year").textContent=new Date().getFullYear();

/* ================= DEVICE LOCK ================= */
const deviceKey="dev-"+btoa(navigator.userAgent+screen.width+screen.height);
if(localStorage.lc_device&&localStorage.lc_device!==deviceKey){alert("Locked to another device"); document.body.innerHTML="DEVICE LOCKED"; throw"";} else{localStorage.lc_device=deviceKey;}

/* ================= TRIAL/SUBSCRIPTION ================= */
if(!localStorage.lc_start) localStorage.lc_start=Date.now();
let subscribed=localStorage.lc_sub==="yes";

function renderSub(){
    const box=document.getElementById("subscriptionUI");
    if(subscribed){document.getElementById("mainApp").style.display="block"; box.innerHTML="Subscription Active ‚úì"; return;}
    let rem=Math.floor((30*86400000-(Date.now()-localStorage.lc_start))/86400000);
    if(Date.now()-localStorage.lc_start<30*86400000){
        box.innerHTML=`Trial: ${rem} days left<br><button onclick="pay()">Buy ‚Çπ299/month</button>`;
        document.getElementById("mainApp").style.display="block";
    } else {
        box.innerHTML=`Trial expired<br><button onclick="pay()">Buy ‚Çπ299/month</button><br>
        <input id='adm' placeholder='Admin Code'><button onclick='admUnlock()'>Unlock</button>`;
    }
}
renderSub();

function pay(){alert("Scan QR to Pay ‚Çπ299 or use UPI: 9433082017@ybl");}
function admUnlock(){
    if(document.getElementById("adm")&&document.getElementById("adm").value==="MR-LX9Q-72KF-P8W3"){localStorage.lc_sub="yes"; subscribed=true; renderSub();} else alert("Invalid Code");
}

/* ================= PRODUCTS ================= */
let products=[];
function openPopup(){document.getElementById("popup").style.display="block";}
function closePopup(){document.getElementById("popup").style.display="none";}
function saveProduct(){
    const pname=document.getElementById("pname").value.trim();
    if(!pname){alert("Enter Product Name");return;}
    let p={
        name:pname,
        category:document.getElementById("pcategory").value,
        type:document.getElementById("ptype").value,
        grade:document.getElementById("pgrade").value,
        thickness:Number(document.getElementById("pthickness").value)||0,
        color:document.getElementById("pcolor").value,
        size:document.getElementById("psize").value,
        rate:Number(document.getElementById("prate").value)||0,
        qty:Number(document.getElementById("pqty").value)||1,
        waste:Number(document.getElementById("pwaste").value)||0,
        labour:Number(document.getElementById("plabour").value)||0,
        chemical:Number(document.getElementById("pchemical").value)||0,
        machine:Number(document.getElementById("pmachine").value)||0,
        transport:Number(document.getElementById("ptransport").value)||0,
        markup:Number(document.getElementById("pmarkup").value)||0,
        sku:document.getElementById("psku").value,
        note:document.getElementById("pnote").value,
        supplier:document.getElementById("psupplier").value,
        suppliercontact:document.getElementById("psuppliercontact").value,
        batch:document.getElementById("pbatch").value,
        mfg:document.getElementById("pmfg").value,
        origin:document.getElementById("porigin").value,
        ptime:Number(document.getElementById("ptime").value)||0,
        location:document.getElementById("plocation").value,
        tax:document.getElementById("ptax").value
    };
    let base=p.rate*p.qty;
    let wasteCost=base*(p.waste/100);
    let subtotal=base+wasteCost+p.labour+p.chemical+p.machine+p.transport;
    let markupAmt=subtotal*(p.markup/100);
    let gstRate=Number(document.getElementById("gst").value)||0;
    let taxAmt=0;
    if(p.tax=="GST"||p.tax=="IGST") taxAmt=subtotal*(gstRate/100);
    p.total=subtotal+markupAmt+taxAmt;
    products.push(p);
    closePopup();
    renderProducts();
}

function renderProducts(){
    const search=document.getElementById("search").value.toLowerCase();
    const list=document.getElementById("productList");
    list.innerHTML="";
    products.filter(p=>p.name.toLowerCase().includes(search)).forEach((p,i)=>{
        const box=document.createElement("div");
        box.className="product-box";
        box.innerHTML=`
<b>${p.name}</b><br>
Category: ${p.category} | Type: ${p.type} | Grade: ${p.grade}<br>
Thickness: ${p.thickness} mm | Color: ${p.color} | Size: ${p.size}<br>
Rate: ‚Çπ${p.rate} | Qty: ${p.qty}<br>
Waste%: ${p.waste} | Labour: ‚Çπ${p.labour} | Chemical: ‚Çπ${p.chemical}<br>
Machine: ‚Çπ${p.machine} | Transport: ‚Çπ${p.transport} | Markup%: ${p.markup}<br>
SKU: ${p.sku} | Supplier: ${p.supplier} | Contact: ${p.suppliercontact}<br>
Batch: ${p.batch} | MFG: ${p.mfg} | Origin: ${p.origin} | Time: ${p.ptime} h<br>
Location: ${p.location} | Tax Type: ${p.tax}<br>
<b>Total: ‚Çπ${p.total.toFixed(2)}</b><br>
<button class='prod-btn' onclick='duplicateProduct(${i})'>Duplicate</button>
<button class='prod-btn' onclick='deleteProduct(${i})' style='background:#d32f2f;'>Delete</button>`;
        list.appendChild(box);
    });
}
function duplicateProduct(i){products.push(JSON.parse(JSON.stringify(products[i]))); renderProducts();}
function deleteProduct(i){products.splice(i,1); renderProducts();}

/* ================= RESET ALL ================= */
function resetAll(){
    if(confirm("Clear all products and inputs?")){
        products = [];
        document.getElementById("search").value = "";
        document.getElementById("gst").value = 18;
        document.getElementById("profit").value = 20;
        document.getElementById("currency").value = "INR";
        document.getElementById("grandTotal").innerHTML = "";
        renderProducts();
    }
}

/* ================= GRAND TOTAL WITH GST ================= */
function calculateFinal(){
    if(products.length==0){ alert("No products added"); return; }
    
    let subtotal = 0;
    let gstTotal = 0;
    const gstRate = Number(document.getElementById("gst").value) || 0;
    
    products.forEach(p => {
        subtotal += p.total;
        if(p.tax=="GST"||p.tax=="IGST") gstTotal += p.total * (gstRate / 100);
    });

    const profit = Number(document.getElementById("profit").value) || 0;
    const profitAmt = subtotal * (profit/100);

    let grandTotal = subtotal + gstTotal + profitAmt;

    const currency = document.getElementById("currency").value;
    let display = grandTotal;
    if(currency=="USD") display = (grandTotal/82).toFixed(2);

    document.getElementById("grandTotal").innerHTML=
        `Subtotal: ‚Çπ${subtotal.toFixed(2)}<br>
         GST (${gstRate}%): ‚Çπ${gstTotal.toFixed(2)}<br>
         Profit (${profit}%): ‚Çπ${profitAmt.toFixed(2)}<br>
         <b>Grand Total: ${currency=="INR"?"‚Çπ":"$"}${display}</b>`;
}

/* ================= DARK MODE DRAG ================= */
let darkDrag=false;
const toggle=document.getElementById("darkToggle");
toggle.addEventListener("click",()=>{if(!darkDrag){document.body.classList.toggle("dark"); toggle.innerHTML=document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";} darkDrag=false;});
let dx=0,dy=0;
toggle.addEventListener("mousedown",dragStart);
toggle.addEventListener("touchstart",dragStart);
function dragStart(e){
    let evt=e.touches?e.touches[0]:e;
    dx=evt.clientX-toggle.offsetLeft; dy=evt.clientY-toggle.offsetTop;
    document.addEventListener("mousemove",dragMove); document.addEventListener("mouseup",dragEnd);
    document.addEventListener("touchmove",dragMove); document.addEventListener("touchend",dragEnd);
}
function dragMove(e){darkDrag=true; let evt=e.touches?e.touches[0]:e; toggle.style.left=evt.clientX-dx+"px"; toggle.style.top=evt.clientY-dy+"px";}
function dragEnd(){document.removeEventListener("mousemove",dragMove); document.removeEventListener("mouseup",dragEnd); document.removeEventListener("touchmove",dragMove); document.removeEventListener("touchend",dragEnd);}
</script>

</body>
</html>
